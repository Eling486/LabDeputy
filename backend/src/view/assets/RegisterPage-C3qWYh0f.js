import{_ as S,u as T,a as $,b as I,s as N,r as d,c as y,o as j,d as k,e as z,f as h,t as R,g as t,h as l,w as i,i as A,E as C,j as D,k as Z,l as V,m as O,n as G,p as H}from"./index-mqPUoEfO.js";import{E as x}from"./index-CCnng1Ex.js";const J={class:"login-wrap"},K={class:"login-box"},L={class:"login-title"},Q={__name:"RegisterPage",setup(W){const _=T(),w=$(),E=I(),{settings:r}=N(E),o=A("langs"),c=d(""),m=d(""),p=d(!1),f=d(!1),a=y({username:"",realname:"",password:"",passwordRepeat:""}),v=d();let b=new RegExp(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/);const P=(g,e,s)=>e===""?s(new Error(o[r.value.lang].login.msg_need_password)):(console.log(e),b.test(e)?s():s(new Error(o[r.value.lang].login.msg_error_password_illegal))),q=(g,e,s)=>a.passwordRepeat===""?s(new Error(o[r.value.lang].login.msg_need_repeat_password)):a.passwordRepeat!==a.password?s(new Error(o[r.value.lang].login.msg_error_password_repeat)):s(),U=y({username:[{required:!0,message:o[r.value.lang].login.msg_need_username,trigger:"change"}],realname:[{required:!0,message:o[r.value.lang].login.msg_need_realname,trigger:"change"}],password:[{validator:P,trigger:"change"}],password_repeat:[{validator:q,trigger:"change"}]}),B=async g=>{g.validate(async e=>{if(m.value="",c.value="",e){p.value=!0;let s=await Z("POST","/api/user/register",{invitation:w.query.invitation,username:a.username,realname:a.realname,password:V.sha256(`${a.username}${V.sha256(a.password)}`)}).catch(n=>(p.value=!1,n.code===-50302?m.value=n.msg:(x({message:n.msg,type:"error",plain:!0}),console.error(n))));if(s.code!==0)return;console.log(s),f.value=!0,p.value=!1,x({message:o[r.value.lang].login.msg_success_register,type:"success"}),setTimeout(()=>{_.push("/login")},3e3)}})};return j(()=>{if(!w.query.invitation)return _.push("/login")}),(g,e)=>{const s=O,n=G,F=H,M=C;return k(),z("div",J,[h("div",K,[h("div",L,R(t(o)[t(r).lang].login.register),1),l(M,{ref_key:"registerFormRef",ref:v,model:a,rules:U,"label-width":"auto",style:{"max-width":"600px"},"hide-required-asterisk":""},{default:i(()=>[l(n,{label:t(o)[t(r).lang].login.username,prop:"username",error:m.value},{default:i(()=>[l(s,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=u=>a.username=u),style:{width:"220px"}},null,8,["modelValue"])]),_:1},8,["label","error"]),l(n,{label:t(o)[t(r).lang].login.realname,prop:"realname"},{default:i(()=>[l(s,{modelValue:a.realname,"onUpdate:modelValue":e[1]||(e[1]=u=>a.realname=u),style:{width:"220px"},name:"realname"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:t(o)[t(r).lang].login.password,prop:"password",error:c.value},{default:i(()=>[l(s,{modelValue:a.password,"onUpdate:modelValue":e[2]||(e[2]=u=>a.password=u),type:"password",style:{width:"220px"},"show-password":""},null,8,["modelValue"])]),_:1},8,["label","error"]),l(n,{label:t(o)[t(r).lang].login.password_repeat,prop:"password_repeat"},{default:i(()=>[l(s,{modelValue:a.passwordRepeat,"onUpdate:modelValue":e[3]||(e[3]=u=>a.passwordRepeat=u),type:"password",style:{width:"220px"},"show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{style:{float:"right"}},{default:i(()=>[l(F,{type:"primary",onClick:e[4]||(e[4]=u=>B(v.value)),loading:p.value,disable:f.value},{default:i(()=>[D(R(t(o)[t(r).lang].login.register),1)]),_:1},8,["loading","disable"])]),_:1})]),_:1},8,["model","rules"])])])}}},ee=S(Q,[["__scopeId","data-v-5b8ec6a2"]]);export{ee as default};
